/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import { TestBed } from '@angular/core/testing';
import { BehaviorSubject } from 'rxjs';
import { ActionsSubject, INITIAL_STATE, ReducerManager, Store, createSelector, } from '@ngrx/store';
import { MockState } from './mock_state';
import { MOCK_SELECTORS } from './tokens';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './mock_state';
import * as ɵngcc2 from '@ngrx/store';
if (typeof afterEach === 'function') {
    afterEach((/**
     * @return {?}
     */
    () => {
        try {
            /** @type {?} */
            const store = (/** @type {?} */ (TestBed.get(Store)));
            if (store && 'resetSelectors' in store) {
                store.resetSelectors();
            }
        }
        catch (_a) { }
    }));
}
/**
 * @template T
 */
export class MockStore extends Store {
    /**
     * @param {?} state$
     * @param {?} actionsObserver
     * @param {?} reducerManager
     * @param {?} initialState
     * @param {?=} mockSelectors
     */
    constructor(state$, actionsObserver, reducerManager, initialState, mockSelectors) {
        super(state$, actionsObserver, reducerManager);
        this.state$ = state$;
        this.initialState = initialState;
        this.resetSelectors();
        this.setState(this.initialState);
        this.scannedActions$ = actionsObserver.asObservable();
        if (mockSelectors) {
            mockSelectors.forEach((/**
             * @param {?} mockSelector
             * @return {?}
             */
            mockSelector => {
                /** @type {?} */
                const selector = mockSelector.selector;
                if (typeof selector === 'string') {
                    this.overrideSelector(selector, mockSelector.value);
                }
                else {
                    this.overrideSelector(selector, mockSelector.value);
                }
            }));
        }
    }
    /**
     * @param {?} nextState
     * @return {?}
     */
    setState(nextState) {
        this.state$.next(nextState);
        this.lastState = nextState;
    }
    /**
     * @template T, Result
     * @param {?} selector
     * @param {?} value
     * @return {?}
     */
    overrideSelector(selector, value) {
        MockStore.selectors.set(selector, value);
        if (typeof selector === 'string') {
            /** @type {?} */
            const stringSelector = createSelector((/**
             * @return {?}
             */
            () => { }), (/**
             * @return {?}
             */
            () => value));
            return stringSelector;
        }
        selector.setResult(value);
        return selector;
    }
    /**
     * @return {?}
     */
    resetSelectors() {
        MockStore.selectors.forEach((/**
         * @param {?} _
         * @param {?} selector
         * @return {?}
         */
        (_, selector) => {
            if (typeof selector !== 'string') {
                selector.release();
                selector.setResult();
            }
        }));
        MockStore.selectors.clear();
    }
    /**
     * @param {?} selector
     * @param {?=} prop
     * @return {?}
     */
    select(selector, prop) {
        if (typeof selector === 'string' && MockStore.selectors.has(selector)) {
            return new BehaviorSubject(MockStore.selectors.get(selector)).asObservable();
        }
        return super.select(selector, prop);
    }
    /**
     * @return {?}
     */
    addReducer() {
        /* noop */
    }
    /**
     * @return {?}
     */
    removeReducer() {
        /* noop */
    }
    /**
     * Refreshes the existing state.
     * @return {?}
     */
    refreshState() {
        this.setState(Object.assign({}, ((/** @type {?} */ (this.lastState)))));
    }
}
MockStore.ɵfac = function MockStore_Factory(t) { return new (t || MockStore)(ɵngcc0.ɵɵinject(ɵngcc1.MockState), ɵngcc0.ɵɵinject(ɵngcc2.ActionsSubject), ɵngcc0.ɵɵinject(ɵngcc2.ReducerManager), ɵngcc0.ɵɵinject(INITIAL_STATE), ɵngcc0.ɵɵinject(MOCK_SELECTORS)); };
MockStore.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: MockStore, factory: MockStore.ɵfac });
MockStore.selectors = new Map();
/** @nocollapse */
MockStore.ctorParameters = () => [
    { type: MockState },
    { type: ActionsSubject },
    { type: ReducerManager },
    { type: undefined, decorators: [{ type: Inject, args: [INITIAL_STATE,] }] },
    { type: Array, decorators: [{ type: Inject, args: [MOCK_SELECTORS,] }] }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(MockStore, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.MockState }, { type: ɵngcc2.ActionsSubject }, { type: ɵngcc2.ReducerManager }, { type: undefined, decorators: [{
                type: Inject,
                args: [INITIAL_STATE]
            }] }, { type: Array, decorators: [{
                type: Inject,
                args: [MOCK_SELECTORS]
            }] }]; }, null); })();
if (false) {
    /** @type {?} */
    MockStore.selectors;
    /** @type {?} */
    MockStore.prototype.scannedActions$;
    /**
     * @type {?}
     * @private
     */
    MockStore.prototype.lastState;
    /**
     * @type {?}
     * @private
     */
    MockStore.prototype.state$;
    /**
     * @type {?}
     * @private
     */
    MockStore.prototype.initialState;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ja19zdG9yZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vbW9kdWxlcy9zdG9yZS90ZXN0aW5nL3NyYy9tb2NrX3N0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDaEQsT0FBTyxFQUFjLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNuRCxPQUFPLEVBRUwsY0FBYyxFQUNkLGFBQWEsRUFDYixjQUFjLEVBQ2QsS0FBSyxFQUNMLGNBQWMsR0FHZixNQUFNLGFBQWEsQ0FBQztBQUNyQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXpDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUM7Ozs7QUFFMUMsSUFBSSxPQUFPLFNBQVMsS0FBSyxVQUFVLEVBQUU7QUFDckMsSUFBRSxTQUFTO0FBQU07QUFFWDtBQUFRLElBRkYsR0FBRyxFQUFFO0FBQ2pCLFFBQUksSUFBSTtBQUNSO0FBQTZCLGtCQUFqQixLQUFLLEdBQUcsbUJBQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBa0I7QUFDeEQsWUFBTSxJQUFJLEtBQUssSUFBSSxnQkFBZ0IsSUFBSSxLQUFLLEVBQUU7QUFDOUMsZ0JBQVEsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQy9CLGFBQU87QUFDUCxTQUFLO0FBQUMsUUFBQSxXQUFNLEdBQUU7QUFDZCxJQUFFLENBQUMsRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQUNEO0FBQ0c7QUFDQztBQUFKLE1BQU0sT0FBTyxTQUFhLFNBQVEsS0FBUTtBQUMxQztBQUFRO0FBQ0w7QUFDcUI7QUFDQTtBQUNqQjtBQUdpQjtBQUFRLElBRzlCLFlBQ1UsTUFBb0IsRUFDNUIsZUFBK0IsRUFDL0IsY0FBOEIsRUFD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LENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FDbEMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUN2QixTQUFLO0FBQ0wsUUFDSSxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3hDLElBQUUsQ0FBQztBQUNIO0FBQ087QUFDRTtBQUNQLElBRkEsVUFBVTtBQUNaLFFBQUksVUFBVTtBQUNkLElBQUUsQ0FBQztBQUNIO0FBQ087QUFDRDtBQUFRLElBRFosYUFBYTtBQUNmLFFBQUksVUFBVTtBQUNkLElBQUUsQ0FBQztBQUNIO0FBRUM7QUFDRTtBQUNhO0FBQ1gsSUFESCxZQUFZO0FBQ2QsUUFBSSxJQUFJLENBQUMsUUFBUSxtQkFBTSxDQUFDLG1CQUFBLElBQUksQ0FBQyxTQUFTLEVBQUssQ0FBQyxFQUFHLENBQUM7QUFDaEQsSUFBRSxDQUFDO0FBQ0g7OzJGQUFDO0FBekdRLG1CQUFTLEdBQUcsSUFBSSxHQUFHLEVBS3ZCLENBQUMsQUFOSjtBQUFDO2tCQURGLFVBQVUsNUJBQ1c7QUFDVixZQWpCSCxTQUFTO0FBQUksWUFScEIsY0FBYztBQUNkLFlBQ0EsY0FBYztBQUNkLDRDQW9DRyxNQUFNLFNBQUMsYUFBYTtBQUFTLHdDQUM3QixNQUFNLFNBQUMsY0FBYztBQUFROzs7Ozs7Ozs7a0NBQUU7QUFBQztBQUFhO0FBRTVDLElBakJKLG9CQUtJO0FBQ047QUFDb0IsSUFBbEIsb0NBQTJDO0FBQzdDO0FBQVE7QUFFUjtBQUNDO0FBQVEsSUFIUCw4QkFBcUI7QUFDdkI7QUFDTztBQUNFO0FBQWdCO0FBQVEsSUFBN0IsMkJBQTRCO0FBQUM7QUFDMUI7QUFBaUI7QUFDckI7QUFBUSxJQUNQLGlDQUE4QztBQUFDO0FBQ2xEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUZXN0QmVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbmltcG9ydCB7IE9ic2VydmFibGUsIEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgQWN0aW9uLFxuICBBY3Rpb25zU3ViamVjdCxcbiAgSU5JVElBTF9TVEFURSxcbiAgUmVkdWNlck1hbmFnZXIsXG4gIFN0b3JlLFxuICBjcmVhdGVTZWxlY3RvcixcbiAgTWVtb2l6ZWRTZWxlY3RvcldpdGhQcm9wcyxcbiAgTWVtb2l6ZWRTZWxlY3Rvcixcbn0gZnJvbSAnQG5ncngvc3RvcmUnO1xuaW1wb3J0IHsgTW9ja1N0YXRlIH0gZnJvbSAnLi9tb2NrX3N0YXRlJztcbmltcG9ydCB7IE1vY2tTZWxlY3RvciB9IGZyb20gJy4vbW9ja19zZWxlY3Rvcic7XG5pbXBvcnQgeyBNT0NLX1NFTEVDVE9SUyB9IGZyb20gJy4vdG9rZW5zJztcblxuaWYgKHR5cGVvZiBhZnRlckVhY2ggPT09ICdmdW5jdGlvbicpIHtcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmUgPSBUZXN0QmVkLmdldChTdG9yZSkgYXMgTW9ja1N0b3JlPGFueT47XG4gICAgICBpZiAoc3RvcmUgJiYgJ3Jlc2V0U2VsZWN0b3JzJyBpbiBzdG9yZSkge1xuICAgICAgICBzdG9yZS5yZXNldFNlbGVjdG9ycygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge31cbiAgfSk7XG59XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBNb2NrU3RvcmU8VD4gZXh0ZW5kcyBTdG9yZTxUPiB7XG4gIHN0YXRpYyBzZWxlY3RvcnMgPSBuZXcgTWFwPFxuICAgIHwgc3RyaW5nXG4gICAgfCBNZW1vaXplZFNlbGVjdG9yPGFueSwgYW55PlxuICAgIHwgTWVtb2l6ZWRTZWxlY3RvcldpdGhQcm9wczxhbnksIGFueSwgYW55PixcbiAgICBhbnlcbiAgPigpO1xuXG4gIHB1YmxpYyBzY2FubmVkQWN0aW9ucyQ6IE9ic2VydmFibGU8QWN0aW9uPjtcbiAgcHJpdmF0ZSBsYXN0U3RhdGU6IFQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBzdGF0ZSQ6IE1vY2tTdGF0ZTxUPixcbiAgICBhY3Rpb25zT2JzZXJ2ZXI6IEFjdGlvbnNTdWJqZWN0LFxuICAgIHJlZHVjZXJNYW5hZ2VyOiBSZWR1Y2VyTWFuYWdlcixcbiAgICBASW5qZWN0KElOSVRJQUxfU1RBVEUpIHByaXZhdGUgaW5pdGlhbFN0YXRlOiBULFxuICAgIEBJbmplY3QoTU9DS19TRUxFQ1RPUlMpIG1vY2tTZWxlY3RvcnM/OiBNb2NrU2VsZWN0b3JbXVxuICApIHtcbiAgICBzdXBlcihzdGF0ZSQsIGFjdGlvbnNPYnNlcnZlciwgcmVkdWNlck1hbmFnZXIpO1xuICAgIHRoaXMucmVzZXRTZWxlY3RvcnMoKTtcbiAgICB0aGlzLnNldFN0YXRlKHRoaXMuaW5pdGlhbFN0YXRlKTtcbiAgICB0aGlzLnNjYW5uZWRBY3Rpb25zJCA9IGFjdGlvbnNPYnNlcnZlci5hc09ic2VydmFibGUoKTtcbiAgICBpZiAobW9ja1NlbGVjdG9ycykge1xuICAgICAgbW9ja1NlbGVjdG9ycy5mb3JFYWNoKG1vY2tTZWxlY3RvciA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gbW9ja1NlbGVjdG9yLnNlbGVjdG9yO1xuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHRoaXMub3ZlcnJpZGVTZWxlY3RvcihzZWxlY3RvciwgbW9ja1NlbGVjdG9yLnZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm92ZXJyaWRlU2VsZWN0b3Ioc2VsZWN0b3IsIG1vY2tTZWxlY3Rvci52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNldFN0YXRlKG5leHRTdGF0ZTogVCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUkLm5leHQobmV4dFN0YXRlKTtcbiAgICB0aGlzLmxhc3RTdGF0ZSA9IG5leHRTdGF0ZTtcbiAgfVxuXG4gIG92ZXJyaWRlU2VsZWN0b3I8VCwgUmVzdWx0PihcbiAgICBzZWxlY3Rvcjogc3RyaW5nLFxuICAgIHZhbHVlOiBSZXN1bHRcbiAgKTogTWVtb2l6ZWRTZWxlY3RvcjxzdHJpbmcsIFJlc3VsdD47XG4gIG92ZXJyaWRlU2VsZWN0b3I8VCwgUmVzdWx0PihcbiAgICBzZWxlY3RvcjogTWVtb2l6ZWRTZWxlY3RvcjxULCBSZXN1bHQ+LFxuICAgIHZhbHVlOiBSZXN1bHRcbiAgKTogTWVtb2l6ZWRTZWxlY3RvcjxULCBSZXN1bHQ+O1xuICBvdmVycmlkZVNlbGVjdG9yPFQsIFJlc3VsdD4oXG4gICAgc2VsZWN0b3I6IE1lbW9pemVkU2VsZWN0b3JXaXRoUHJvcHM8VCwgYW55LCBSZXN1bHQ+LFxuICAgIHZhbHVlOiBSZXN1bHRcbiAgKTogTWVtb2l6ZWRTZWxlY3RvcldpdGhQcm9wczxULCBhbnksIFJlc3VsdD47XG4gIG92ZXJyaWRlU2VsZWN0b3I8VCwgUmVzdWx0PihcbiAgICBzZWxlY3RvcjpcbiAgICAgIHwgc3RyaW5nXG4gICAgICB8IE1lbW9pemVkU2VsZWN0b3I8YW55LCBhbnk+XG4gICAgICB8IE1lbW9pemVkU2VsZWN0b3JXaXRoUHJvcHM8YW55LCBhbnksIGFueT4sXG4gICAgdmFsdWU6IGFueVxuICApIHtcbiAgICBNb2NrU3RvcmUuc2VsZWN0b3JzLnNldChzZWxlY3RvciwgdmFsdWUpO1xuXG4gICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IHN0cmluZ1NlbGVjdG9yID0gY3JlYXRlU2VsZWN0b3IoKCkgPT4ge30sICgpID0+IHZhbHVlKTtcblxuICAgICAgcmV0dXJuIHN0cmluZ1NlbGVjdG9yO1xuICAgIH1cblxuICAgIHNlbGVjdG9yLnNldFJlc3VsdCh2YWx1ZSk7XG5cbiAgICByZXR1cm4gc2VsZWN0b3I7XG4gIH1cblxuICByZXNldFNlbGVjdG9ycygpIHtcbiAgICBNb2NrU3RvcmUuc2VsZWN0b3JzLmZvckVhY2goKF8sIHNlbGVjdG9yKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHNlbGVjdG9yICE9PSAnc3RyaW5nJykge1xuICAgICAgICBzZWxlY3Rvci5yZWxlYXNlKCk7XG4gICAgICAgIHNlbGVjdG9yLnNldFJlc3VsdCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgTW9ja1N0b3JlLnNlbGVjdG9ycy5jbGVhcigpO1xuICB9XG5cbiAgc2VsZWN0KHNlbGVjdG9yOiBhbnksIHByb3A/OiBhbnkpIHtcbiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJyAmJiBNb2NrU3RvcmUuc2VsZWN0b3JzLmhhcyhzZWxlY3RvcikpIHtcbiAgICAgIHJldHVybiBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4oXG4gICAgICAgIE1vY2tTdG9yZS5zZWxlY3RvcnMuZ2V0KHNlbGVjdG9yKVxuICAgICAgKS5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VwZXIuc2VsZWN0KHNlbGVjdG9yLCBwcm9wKTtcbiAgfVxuXG4gIGFkZFJlZHVjZXIoKSB7XG4gICAgLyogbm9vcCAqL1xuICB9XG5cbiAgcmVtb3ZlUmVkdWNlcigpIHtcbiAgICAvKiBub29wICovXG4gIH1cblxuICAvKipcbiAgICogUmVmcmVzaGVzIHRoZSBleGlzdGluZyBzdGF0ZS5cbiAgICovXG4gIHJlZnJlc2hTdGF0ZSgpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgLi4uKHRoaXMubGFzdFN0YXRlIGFzIFQpIH0pO1xuICB9XG59XG4iXX0=